{% extends 'base.html' %}
{% load static %}
{% block title %}
{{ product.name }}
{% endblock %}
{% block content %}
<section class="py-5 border-bottom">
    <div class="container w-100">
      <div class="row gx-5">
        <aside class="col-lg-6">
            <div class="border rounded-4 mb-3 d-flex justify-content-center">
                {% if product.images.all %}
                    <!-- Главное изображение продукта -->
                    <img id="main-image" style="width: 100%; max-height: 500px; margin: auto; object-fit: contain;" class="rounded-4 fit" src="{{ product.images.all.0.image.url }}" alt="{{ product.name }}" />
                {% else %}
                    <!-- Placeholder если нет изображений -->
                    <img style="max-width: 100%; max-height: 100vh; margin: auto;" class="rounded-4 fit" src="placeholder-image-url.jpg" alt="Нет изображения" />
                {% endif %}
            </div>
            <div class="d-flex justify-content-center mb-3">
                {% for image in product.images.all %}
                <div class="border mx-1 rounded-2">
                    <img onclick="changeMainImage('{{ image.image.url }}')" width="60" height="60" class="rounded-2" src="{{ image.image.url }}" alt="{{ product.name }}" style="object-fit: contain; cursor: pointer;"/>
                </div>
            {% endfor %}
            </div>
            <a href="{% url 'map' %}" class="btn btn-primary shadow-0 w-100 d-block"></i>Где купить</a>
        </aside>
        <main class="col-lg-6">
          <div class="ps-lg-3">
            <h4 class="title text-dark">
                {{ product.name }}
            </h4>  
            <div class="mb-3">
              <span class="h5">
                {% if product.features %}
                {{ product.features }}
                {% endif %}
              </span>
              <!-- <span class="text-muted">что то</span> -->
            </div>
  
            <p>
                {{ product.description }}
            </p>
            <hr/>
            <div class="row">
              <dt class="col-4">Процессор:</dt>
              <dd class="col-8">
                {% for brand, processors in processors_by_brand.items %}
                {% if not forloop.first %}<br>{% endif %}{{ brand }} {% for processor_type, processor_list in processors.items %}{% if processor_type %}{{ processor_type }} {% endif %}{% for processor in processor_list %}{{ processor }}{% if not forloop.last %}/{% endif %}{% endfor %}{% if not forloop.last %}/{% endif %}
                {% endfor %}
            {% endfor %}
              </dd>
        
              <dt class="col-4">Оперативная память:</dt>
              <dd class="col-8">
                {% if min_ram_size is not none and max_ram_size is not none %}
                  от {{ min_ram_size }} ГБ до {{ max_ram_size }} ГБ
                {% endif %}
              </dd>
              
              <dt class="col-4">Накопители:</dt>
              <dd class="col-8">
                {% if min_storage_size is not none and max_storage_size is not none %}
                  от {{ min_storage_size }} {% if min_storage_unit == "GB" %} ГБ {% else %} ТБ {% endif %}
                  до {{ max_storage_size }} {% if max_storage_unit == "GB" %} ГБ {% else %} ТБ {% endif %}
                {% endif %}
              </dd>
              
  
              <dt class="col-4">Вес:</dt>
              <dd class="col-8">                          
                {% if product.weight %}
                {{ product.weight }} кг
                {% endif %}</dd>
            </div>
          </div>
        </main>
      </div>
    </div>
  </section>
  
  <!-- content -->

  
  <!-- Page Content -->
  {% for description in descriptions %}
  <section class="py-4 bg-light">
    <div class="image-container" style="background-image: url('{{ description.image.url }}');">
  </div>
    <div class="container w-100">
      <div class="row gx-5">
      <h2 class="fw-light mt-2 mb-2">{{ description.title }}</h2>
      <p>{{ description.text }}</p>
      </div>
    </div>
  </section>
  {% endfor %}

  <section class="border-top py-4">
    <div class="container w-100">
      <div class="row">
        <div class="col-lg-8 mb-4">
          <div class="border rounded-2 px-3 py-2 bg-white">
            <!-- Pills navs -->
            <ul class="nav nav-pills nav-justified mb-3" id="ex1" role="tablist">
              <li class="nav-item d-flex" role="presentation">
                <a class="nav-link d-flex align-items-center justify-content-center w-100 active h-auto" id="ex1-tab-1" data-mdb-toggle="pill" href="#ex1-pills-1" role="tab" aria-controls="ex1-pills-1" aria-selected="true">ПРОИЗВОДИТЕЛЬНОСТЬ</a>
              </li>
              <li class="nav-item d-flex" role="presentation">
                <a class="nav-link d-flex align-items-center justify-content-center w-100 h-auto" id="ex1-tab-2" data-mdb-toggle="pill" href="#ex1-pills-2" role="tab" aria-controls="ex1-pills-2" aria-selected="false">СРЕДСТВА КОММУНИКАЦИИ</a>
              </li>
              <li class="nav-item d-flex" role="presentation">
                <a class="nav-link d-flex align-items-center justify-content-center w-100 h-auto" id="ex1-tab-3" data-mdb-toggle="pill" href="#ex1-pills-3" role="tab" aria-controls="ex1-pills-3" aria-selected="false">КОНСТРУКЦИЯ</a>
              </li>
              <li class="nav-item d-flex" role="presentation">
                <a class="nav-link d-flex align-items-center justify-content-center w-100 h-auto" id="ex1-tab-4" data-mdb-toggle="pill" href="#ex1-pills-4" role="tab" aria-controls="ex1-pills-4" aria-selected="false">ПРОЧАЯ ИНФОРМАЦИЯ</a>
              </li>
            </ul>
            <!-- Pills navs -->
  
            <!-- Pills content -->
            <div class="tab-content" id="ex1-content">
              <div class="tab-pane fade show active" id="ex1-pills-1" role="tabpanel" aria-labelledby="ex1-tab-1">
                <table class="table border mt-3 mb-2">
                  <tr>
                    <th class="py-2">Процессор:</th>
                    <td class="py-2 text-break">
                      {% for brand, processors in processors_by_brand.items %}
                      {% for processor_type, processor_list in processors.items %}
                          <li>{{ brand }}: 
                              {% if processor_type != "" %}
                                  {{ processor_type }} 
                              {% endif %} {% for processor in processor_list %}{{ processor }}{% if not forloop.last %}/{% endif %}{% endfor %}
                          </li>
                      {% endfor %}
                  {% endfor %}
                    </td>
                  </tr>
                  <tr>
                    <th class="py-2">Материнская плата:</th>
                    <td class="py-2 text-break">
                      {% for line, types in motherboards_by_line.items %}
                      <li>{{ line }}: {% for type, names in types.items %}{{ type }}{% if not forloop.last %}/{% endif %}{% endfor %}
                      </li>
                    {% endfor %}
                    </td>
                  </tr>
                  <tr>
                    <th class="py-2">Операционная система:</th>
                    <td class="py-2 text-break">
                      {% if product.operating_system.all %}
                      {{ product.operating_system }}
                      {% endif %}
                    </td>
                  </tr>
                  <!-- <tr>
                    <th class="py-2">Видеокарта:</th>
                    <td class="py-2">{{ product.graphics }}</td>
                  </tr> -->
                  <tr>
                    <th class="py-2">Оперативная память:</th>
                    <td class="py-2 text-break">
                      {% for ram_type, sizes in ram_by_type.items %}
                      <li>{{ ram_type }}:
                      {% for size in sizes %}{{ size }}{% if not forloop.last %}/{% endif %}{% endfor %} ГБ
                      </li>
                      {% endfor %}
                    </td>
                  </tr>
                  <tr>
                    <th class="py-2">Накопители:</th>
                    <td class="py-2 text-break">
                        {% for storage_type, sizes in formatted_storage_by_type.items %}
                            <li>{{ storage_type }}: {% for size, unit in sizes %}{{ size }}{{ unit }}{% if not forloop.last %}/{% endif %}{% endfor %}</li>
                        {% endfor %}
                    </td>
                  </tr>
                </table>
              </div>
              <div class="tab-pane fade mb-2" id="ex1-pills-2" role="tabpanel" aria-labelledby="ex1-tab-2">
                <table class="table border mt-3 mb-2">
                    <tr>
                        <th class="py-2 align-middle">Порты и разъемы:</th>
                        <td class="py-2 text-break">
                            <ul style="margin: auto;">
                                {% for port in product.ports.all %}
                                    <li>{{ port.name }}</li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>                    
                    <tr>
                      <th class="py-2 align-middle">Беспроводные технологии:</th>
                      <td class="py-2 text-break"></td>
                    </tr>
                  </table>
              </div>
              <div class="tab-pane fade mb-2" id="ex1-pills-3" role="tabpanel" aria-labelledby="ex1-tab-3">
                <table class="table border mt-3 mb-2">
                    <tr>
                        <th class="py-2 align-middle">Дисплей:</th>
                        <td class="py-2 text-break">
                          {% if product.screen_sizes.all %}{% for screen_size in product.screen_sizes.all %}{{ screen_size.size }}{% if not forloop.last %}/{% endif %}{% endfor %} дюймов{% endif %}
                        </td>
                    </tr>                    
                    <tr>
                      <th class="py-2 align-middle">Габариты (В × Ш × Г):</th>
                      <td class="py-2 text-break"></td>
                    </tr>
                    <tr>
                        <th class="py-2 align-middle">Вес:</th>
                        <td class="py-2 text-break">
                          {% if product.weight %}
                          {{ product.weight }} кг
                          {% endif %}
                        </td>
                      </tr>
                      <tr>
                        <th class="py-2 align-middle">Цвет:</th>
                        <td class="py-2 text-break"></td>
                      </tr>
                      <tr>
                        <th class="py-2 align-middle">Подсветка клавиатуры:</th>
                        <td class="py-2 text-break">
                            {% for light in product.keyboard_backlight.all %}{{ light.light }}{% if not forloop.last %}/{% endif %}{% endfor %}
                        </td>
                    </tr>
                    <tr>
                        <th class="py-2 align-middle">Разрешение экрана:</th>
                        <td class="py-2 text-break">
                            {% for resolution in product.screen_resolution.all %}{{ resolution.resolution }}{% if not forloop.last %}/{% endif %}{% endfor %}
                        </td>
                    </tr>
                  </table>
              </div>
              <div class="tab-pane fade mb-2" id="ex1-pills-4" role="tabpanel" aria-labelledby="ex1-tab-4">
                <table class="table border mt-3 mb-2">
                  <tr>
                      <th class="py-2 align-middle">Предустановленное ПО:</th>
                      <td class="py-2 text-break"></td>
                  </tr>                    
                  <tr>
                      <th class="py-2 align-middle">Комплектация:</th>
                      <td class="py-2 text-break"></td>
                  </tr>
                  <tr>
                      <th class="py-2 align-middle">Мощность блока питания:</th>
                      <td class="py-2 text-break">
                        {% if product.power_supplies.all %}{% for power in product.power_supplies.all %}{{ power.power }}{% if not forloop.last %}/{% endif %}{% endfor %} Вт{% endif %}
                      </td>
                  </tr>
                  <tr>
                    <th class="py-2 align-middle">Температура эксплуатации:</th>
                    <td class="py-2 text-break">
                      {% if product.operating_temperature is not none %}
                        {{ product.operating_temperature }}
                      {% endif %}
                    </td>
                  </tr>
                  <tr>
                    <th class="py-2 align-middle">Температура хранения:</th>
                    <td class="py-2 text-break">
                      {% if product.storage_temperature is not none %}
                        {{ product.storage_temperature }}
                      {% endif %}
                    </td>
                  </tr>
                  <tr>
                    <th class="py-2 align-middle">Рабочая влажность:</th>
                    <td class="py-2 text-break">
                      {% if product.operating_humidity is not none %}
                        {{ product.operating_humidity }}
                      {% endif %}
                    </td>
                  </tr>
                  <tr>
                    <th class="py-2 align-middle">Влажность хранения:</th>
                    <td class="py-2 text-break">
                      {% if product.storage_humidity is not none %}
                        {{ product.storage_humidity }}
                      {% endif %}
                    </td>
                  </tr>
              </table>
              
              </div>
            </div>
            <!-- Pills content -->
          </div>
        </div>
        <div class="col-lg-4">
          <div class="px-0 border rounded-2 shadow-0">
            <div class="card no-hover-zoom">
              <div class="card-body">
                <h5 class="card-title">Похожие товары</h5>
                {% for similar_product in similar_products %}
                <a href="{% url 'product_detail' similar_product.id %}" class="d-flex mt-4 hover-zoom-container nav-link">
                  <div class="me-3">
                    <img src="{{ similar_product.images.all.0.image.url }}" style="object-fit: contain; width: 100px; height: 100px;" class="img-md img-thumbnail" />
                  </div>
                  <div class="info">
                    <strong class="text-dark"> {{ similar_product.name }} </strong>
                    <span class="features">{{ similar_product.features }}</span>
                  </div>
                </a>
                {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

{% endblock %}