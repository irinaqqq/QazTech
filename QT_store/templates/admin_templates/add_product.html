{% extends 'admin_templates/admin_base.html' %}
{% load static %}
{% block title %}
Добавить продукт
{% endblock %}
{% block content %}

<style>
    .needs-validation {
    background-color: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 20px;
    margin-top: 20px;
}
.custom-select, .form-control {
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    font-size: 1.1rem;
    line-height: 1.5;
    font-weight: 400;
    padding: .375rem .75rem;
    height: 2.5rem !important;
    }

.custom-select:focus-visible{
    outline: none;
    /* border-color: transparent;
    box-shadow: none;
    border: 1px solid #bdbdbd; */
    border-color: #00a2e8;
}
.form-control:focus{
    box-shadow: none !important;
    border-color: #00a2e8;
}
.form-select:focus{
    box-shadow: none !important;
    border-color: #00a2e8;
}
.form-select{
    height: 2.5rem;
}
.custom-file-input {
    opacity: 0;
    width: 0.1px;
    height: 0.1px;
    position: absolute;
    z-index: -1;
}
.custom-file-label {
    background-color: #00a2e8;
    color: white;
    padding: .375rem .75rem;
    border-radius: 4px;
    cursor: pointer;
    text-align: center;
}
.image-form, .custom-button, .description-form{
    margin-bottom: var(--mdb-gutter-y);
}
</style>


<div class="container py-5" style="width: 80%;">
    <form class="needs-validation" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-sm-6">
            <label for="firstName" class="form-label">Название</label>
            <input type="text" name="name" maxlength="100" required id="id_name" class="form-control mt-auto" placeholder="Введите название продукта">
          </div>
          <div class="col-sm-6">
            <label for="id_category" class="form-label">Категория</label>
            <select name="category" id="id_category" class="form-select">
                <option value="" disabled selected>Выберите категорию</option>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
          </div>
          <div class="col-12">
            <label for="{{ form.features.id_for_label }}" class="form-label">Особенности (кратко)<span class="text-muted"></span></label>
            <input type="text" name="features" id="{{ form.features.id_for_label }}" class="form-control">
        </div>
          <div class="col-12">
            <label for="{{ form.description.id_for_label }}" class="form-label">Описание<span class="text-muted"></span></label>
            <textarea name="description" id="{{ form.description.id_for_label }}" class="form-control" style="min-height: 105px;"></textarea>
          </div>
        </div>
        <hr class="my-4">
        <div class="row g-3">
          <h4 class="m-0 mt-2">Основные характеристики</h4>
          <div class="col-sm-6">
            
              <label for="id_processor" class="form-label">Процессор</label>
              <select name="processor" id="id_processor" class="form-select">
                  <option value="" disabled selected>Выберите процессор</option>
                  {% for processor in form.processor.field.queryset %}
                      <option value="{{ processor.id }}">{{ processor.name }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
              <label for="id_mother" class="form-label">Материнская плата</label>
              <select name="mother" id="id_mother" class="form-select">
                  <option value="" disabled selected>Выберите материнскую плату</option>
                  {% for motherboard in form.mother.field.queryset %}
                      <option value="{{ motherboard.id }}">{{ motherboard.name }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
              <label for="id_storage" class="form-label">Накопители</label>
              <select name="storage" id="id_storage" class="form-select">
                  <option value="" disabled selected>Выберите накопители</option>
                  {% for storage in form.storage.field.queryset %}
                      <option value="{{ storage.id }}">{{ storage }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
              <label for="id_ram" class="form-label">Оперативная память</label>
              <select name="ram" id="id_ram" class="form-select">
                  <option value="" disabled selected>Выберите оперативную память</option>
                  {% for ram in form.ram.field.queryset %}
                      <option value="{{ ram.id }}">{{ ram.size }} ГБ ({{ ram.type }})</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
              <label for="id_graphics" class="form-label">Видеокарта</label>
              <select name="graphics" id="id_graphics" class="form-select">
                  <option value="" disabled selected>Выберите видеокарту</option>
                  {% for graphics in form.graphics.field.queryset %}
                      <option value="{{ graphics.id }}">{{ graphics }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
              <label for="id_power_supplies" class="form-label">Мощность блока питания</label>
              <select name="power_supplies" id="id_power_supplies" class="form-select">
                  <option value="" disabled selected>Выберите мощность блока питания</option>
                  {% for power_supply in form.power_supplies.field.queryset %}
                      <option value="{{ power_supply.id }}">{{ power_supply }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
              <label for="id_controllers" class="form-label">Контроллеры</label>
              <select name="controllers" id="id_controllers" class="form-select">
                  <option value="" disabled selected>Выберите контроллеры</option>
                  {% for controller in form.controllers.field.queryset %}
                      <option value="{{ controller.id }}">{{ controller.name }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
              <label for="id_operating_system" class="form-label">Операционная система</label>
              <select name="operating_system" id="id_operating_system" class="form-select">
                  <option value="" disabled selected>Выберите операционную систему</option>
                  {% for os in form.operating_system.field.queryset %}
                      <option value="{{ os.id }}">{{ os.name }}</option>
                  {% endfor %}
              </select>
          </div>
      </div>
          <hr class="my-4">
          <div class="row g-3">
            <h4 class="m-0 mt-2">Экран и Ввод</h4>
            <div class="col-sm-6">
                <label for="id_screen_sizes" class="form-label">Размер экрана</label>
                <select name="screen_sizes" id="id_screen_sizes" class="form-select">
                    <option value="" disabled selected>Выберите размер экрана</option>
                    {% for size in form.screen_sizes.field.queryset %}
                        <option value="{{ size.id }}">{{ size }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-sm-6">
                <label for="id_screen_types" class="form-label">Тип экрана</label>
                <select name="screen_type" id="id_screen_type" class="form-select">
                    <option value="" disabled selected>Выберите тип экрана</option>
                    {% for type in form.screen_type.field.queryset %}
                        <option value="{{ type.id }}">{{ type }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-sm-6">
                <label for="id_screen_resolutions" class="form-label">Разрешение экрана</label>
                <select name="screen_resolution" id="id_screen_resolution" class="form-select">
                    <option value="" disabled selected>Выберите разрешение экрана</option>
                    {% for resolution in form.screen_resolution.field.queryset %}
                        <option value="{{ resolution.id }}">{{ resolution }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-sm-6">
                <label for="id_touch_screen_touches" class="form-label">Кол-во одновременных касаний</label>
                <select name="touch_screen_touches" id="id_touch_screen_touches" class="form-select">
                    <option value="" disabled selected>Выберите кол-во касаний</option>
                    {% for touch in form.touch_screen_touches.field.queryset %}
                        <option value="{{ touch.id }}">{{ touch }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>


          <hr class="my-4">
          <div class="row g-3">
            <h4 class="m-0 mt-2">Связь и Периферия</h4>
            <div class="col-sm-4">
                <label for="id_webcam" class="form-label">Веб-камера</label>
                <select name="webcam" id="id_webcam" class="form-select">
                    <option value="" disabled selected>Выберите веб-камеру</option>
                    {% for webcam_choice in form.webcam.field.queryset %}
                        <option value="{{ webcam_choice.id }}">{{ webcam_choice }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-sm-4">
                <label for="id_keyset" class="form-label">Комплект клавиатура и мышь</label>
                <select name="keyset" id="id_keyset" class="form-select">
                    <option value="" disabled selected>Выберите тип клавиатуры и мыши</option>
                    {% for keyset_choice in form.keyset.field.queryset %}
                        <option value="{{ keyset_choice.id }}">{{ keyset_choice }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-sm-4">
                <label for="id_keyboard_backlight" class="form-label">Подсветка клавиатуры</label>
                <select name="keyboard_backlight" id="id_keyboard_backlight" class="form-select">
                    <option value="" disabled selected>Есть ли подсветка клавиатуры?</option>
                    {% for backlight_choice in form.keyboard_backlight.field.queryset %}
                        <option value="{{ backlight_choice.id }}">{{ backlight_choice }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
          <hr class="my-4">

          <div class="row g-3">
            <h4 class="m-0 mt-2">Эксплуатация и Габариты</h4>
            <div class="col-sm-4">
              <label for="id_weight" class="form-label">Вес (кг)</label>
              <input type="number" name="weight" id="id_weight" class="form-control" placeholder="Введите вес">
            </div>
          
            <div class="col-sm-4">
              <label for="id_formfactor" class="form-label">Форм-фактор</label>
              <select name="formfactor" id="id_formfactor" class="form-select">
                  <option value="" disabled selected>Выберите форм-фактор</option>
                  {% for formfactor_choice in form.formfactor.field.queryset %}
                      <option value="{{ formfactor_choice.id }}">{{ formfactor_choice }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-4">
              <label for="id_sizes" class="form-label">Размеры</label>
              <select name="sizes" id="id_sizes" class="form-select">
                  <option value="" disabled selected>Выберите размеры</option>
                  {% for size_choice in form.sizes.field.queryset %}
                      <option value="{{ size_choice.id }}">{{ size_choice.name }}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-sm-6">
            <label for="id_operating_temperature" class="form-label">Температура эксплуатации</label>
            <input type="text" name="operating_temperature" id="id_operating_temperature" class="form-control" placeholder="Введите температуру эксплуатации">
        </div>
        <div class="col-sm-6">
            <label for="id_storage_temperature" class="form-label">Температура хранения</label>
            <input type="text" name="storage_temperature" id="id_storage_temperature" class="form-control" placeholder="Введите температуру хранения">
        </div>
        <div class="col-sm-6">
            <label for="id_operating_humidity" class="form-label">Рабочая влажность</label>
            <input type="text" name="operating_humidity" id="id_operating_humidity" class="form-control" placeholder="Введите рабочую влажность">
        </div>
        <div class="col-sm-6">
            <label for="id_storage_humidity" class="form-label">Влажность хранения</label>
            <input type="text" name="storage_humidity" id="id_storage_humidity" class="form-control" placeholder="Введите влажность хранения">
        </div>
        </div>
          <hr class="my-4">
          <div class="row g-3">
          <h4 class="m-0 mt-2">Фотографии продукта</h4>
          <div class="col-sm-6">
          <div id="image-formset">
            {{ image_formset.management_form }}
            {% for form in image_formset %}
                <div class="image-form">
                        <div class="custom-file-upload">
                            <input type="file" name="images-0-image" accept="image/*" id="id_images-0-image" class="custom-file-input">
                            <label for="id_images-0-image" class="custom-select custom-file-label">Выберите файл</label>
                        </div>
                </div>
            {% endfor %}
            </div>
            </div>
            <div class="col-sm-6 d-flex flex-column justify-content-end">
          <button type="button" id="add-image-form" class="form-control custom-button">Добавить еще фото</button>
            </div>
          </div>
        <hr class="my-4">
        <div class="row g-3">
            <h4 class="m-0 mt-2">Описание продукта</h4>
            <div id="description-formset">
                {{ description_formset.management_form }}
                {% for form in description_formset %}
                    <div class="description-form row g-3">
                      <div class="col-sm-6">
                          <label for="{{ form.title.id_for_label }}" class="form-label">Заголовок</label>
                          <input type="text" name="descriptions-0-title" maxlength="255" id="id_descriptions-0-title" class="form-control" placeholder="Введите заголовок текста">
                      </div>
                      <div class="col-sm-6 d-flex flex-column justify-content-end">
                          <input type="file" name="descriptions-0-image" accept="image/*" id="id_descriptions-0-image" class="custom-file-input">
                          <label for="{{ form.image.id_for_label }}" class="custom-select custom-file-label">Выберите изображение</label>
                      </div>
                      <div class="col-sm-12">
                          <label for="{{ form.text.id_for_label }}" class="form-label">Описание:</label>
                          <textarea name="descriptions-0-text" cols="40" rows="10" id="id_descriptions-0-text" class="form-control" style="min-height: 105px;"></textarea>
                      </div>
                    </div>
                {% endfor %}
            </div>
            <div class="col-sm-12">
            <button type="button" id="add-description-form" class="form-control">Добавить еще описание</button>
            </div>
        </div>
        
        <hr class="my-4">
          <button class="w-100 btn btn-primary btn-lg" type="submit">Сохранить</button>
    </form>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Handle image formset
            const addImageButton = document.getElementById('add-image-form');
            const imageTotalForms = document.getElementById('id_images-TOTAL_FORMS');

            addImageButton.addEventListener('click', function () {
                const imageFormsetDiv = document.getElementById('image-formset');
                const currentImageFormCount = imageFormsetDiv.getElementsByClassName('image-form').length;
                const newImageFormHtml = `
                    <div class="image-form">
                        <div class="custom-file-upload">
                            <input type="file" name="images-${currentImageFormCount}-image" accept="image/*" id="id_images-${currentImageFormCount}-image" class="custom-file-input">
                            <label for="id_images-${currentImageFormCount}-image" class="custom-select custom-file-label">Выберите файл</label>
                        </div>
                    </div>`;
                imageFormsetDiv.insertAdjacentHTML('beforeend', newImageFormHtml);
                imageTotalForms.setAttribute('value', currentImageFormCount + 1);

                // Reset the event listener for file input change
                const newFileInput = imageFormsetDiv.querySelector(`#id_images-${currentImageFormCount}-image`);
                const newFileLabel = imageFormsetDiv.querySelector(`label[for="id_images-${currentImageFormCount}-image"]`);

                newFileInput.addEventListener('change', function () {
                    const fileName = this.files[0].name;
                    newFileLabel.innerText = fileName;
                });
            });
        
            // Handle description formset
            const addDescriptionButton = document.getElementById('add-description-form');
            const descriptionTotalForms = document.getElementById('id_descriptions-TOTAL_FORMS');

            addDescriptionButton.addEventListener('click', function () {
                const descriptionFormsetDiv = document.getElementById('description-formset');
                const currentDescriptionFormCount = descriptionFormsetDiv.getElementsByClassName('description-form').length;
                const newDescriptionFormHtml = `
                    <div class="description-form row g-3">
                        <div class="col-sm-6">
                            <label for="id_descriptions-${currentDescriptionFormCount}-title" class="form-label">Заголовок</label>
                            <input type="text" name="descriptions-${currentDescriptionFormCount}-title" maxlength="255" id="id_descriptions-${currentDescriptionFormCount}-title" class="form-control" placeholder="Введите заголовок текста">
                        </div>
                        <div class="col-sm-6 d-flex flex-column justify-content-end">
                            <input type="file" name="descriptions-${currentDescriptionFormCount}-image" accept="image/*" id="id_descriptions-${currentDescriptionFormCount}-image" class="custom-file-input">
                            <label for="id_descriptions-${currentDescriptionFormCount}-image" class="custom-select custom-file-label">Выберите изображение</label>
                        </div>
                        <div class="col-sm-12">
                            <label for="id_descriptions-${currentDescriptionFormCount}-text" class="form-label">Описание:</label>
                            <textarea name="descriptions-${currentDescriptionFormCount}-text" cols="40" rows="10" id="id_descriptions-${currentDescriptionFormCount}-text" class="form-control" style="min-height: 105px;"></textarea>
                        </div>
                    </div>`;
                descriptionFormsetDiv.insertAdjacentHTML('beforeend', newDescriptionFormHtml);
                descriptionTotalForms.setAttribute('value', currentDescriptionFormCount + 1);

                // Reset the event listener for file input change
                const newFileInput = descriptionFormsetDiv.querySelector(`#id_descriptions-${currentDescriptionFormCount}-image`);
                const newFileLabel = descriptionFormsetDiv.querySelector(`label[for="id_descriptions-${currentDescriptionFormCount}-image"]`);

                newFileInput.addEventListener('change', function () {
                    const fileName = this.files[0].name;
                    newFileLabel.innerText = fileName;
                });
            });


            

            const fileInputs1 = document.querySelectorAll('#image-formset input[type="file"]');
            const fileLabels1 = document.querySelectorAll('#image-formset .custom-file-label');

            fileInputs1.forEach((fileInput, index) => {
                fileInput.addEventListener('change', function() {
                    const fileName = this.files[0].name;
                    fileLabels1[index].innerText = fileName;
                });
            });

            // Для второй формы (описание продукта)
            const fileInputs2 = document.querySelectorAll('#description-formset input[type="file"]');
            const fileLabels2 = document.querySelectorAll('#description-formset .custom-file-label');

            fileInputs2.forEach((fileInput, index) => {
                fileInput.addEventListener('change', function() {
                    const fileName = this.files[0].name;
                    fileLabels2[index].innerText = fileName;
                });
            });
        });
        </script>
  
{% endblock %}